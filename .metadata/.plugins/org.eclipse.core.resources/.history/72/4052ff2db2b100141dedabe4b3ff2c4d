import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.util.Scanner;

public class Crypt {

	public static final String keyword = "crypt";
	private char[][] key = new char[5][5];
	private int[][] indecies = new int[25][2];
	private boolean isIFirst;
	

	public void generateKey(String keyword) {
		
		isIFirst = keyword.indexOf('I') <= keyword.indexOf('J');
		keyword = keyword.toUpperCase();
		if (isIFirst) {
			keyword = keyword.replaceAll("J", "I");
		} else {
			keyword = keyword.replaceAll("I", "J");
		}

		StringBuffer tempKey = new StringBuffer(keyword);
		int[] chars = new int[26];

		for (int i = 0; i < tempKey.length(); i++) {
			int k = Character.toUpperCase(tempKey.charAt(i)) - 65;
			if (chars[k] == 0) {
				chars[k]++;
			} else {
				tempKey.deleteCharAt(i);
			}
		}

		for (int i = 0; i < 26; i++) {
			if (chars[i] == 0) {
				tempKey.append((char) (i + 65));
			}
		}
		String temp = tempKey.toString();
		isIFirst = temp.indexOf('I') <= temp.indexOf('J');
		if (isIFirst) {
			temp = temp.replaceAll("J", "");
		} else {
			temp = temp.replaceAll("I", "");
		}
		
		tempKey = new StringBuffer(temp);
		
		
		for(int i = 0; i < 5; i++) {
			for(int j = 0; j < 5; j++) {
				key[i][j] = tempKey.charAt(0);
				if(isIFirst) {
					if(key[i][j] >= 'J') {
						indecies[key[i][j] - 66][0] = i;
						indecies[key[i][j] - 66][1] = j;
					} else {
						indecies[key[i][j] - 65][0] = i;
						indecies[key[i][j] - 65][1] = j;
					}
				} else {
					if(key[i][j] >= 'I') {
						indecies[key[i][j] - 66][0] = i;
						indecies[key[i][j] - 66][1] = j;
					} else {
						indecies[key[i][j] - 65][0] = i;
						indecies[key[i][j] - 65][1] = j;
					}
				}
				tempKey.deleteCharAt(0);
			}
		}
	}
	
	public char[][] getKey() {
		return key;
	}

	public int[][] getIndecies() {
		return indecies;
	}
	public void encrypt(String inputFileName, String outputFileName, String keyword) {
		
		String lineSeparator = System.getProperty("line.separator");
		
		BufferedReader breader = null;
		FileReader reader = null;
		Scanner in = null;
		BufferedWriter bwriter = null;
		FileWriter writer = null;
		generateKey(keyword);
		
		try {
			
			
			reader = new FileReader(inputFileName);
			breader = new BufferedReader(reader);
			in = new Scanner(breader);
			
			writer = new FileWriter(outputFileName);
			bwriter = new BufferedWriter(writer);
			
			
			StringBuffer changingFileData = new StringBuffer();
			char leftover = 0;
			boolean append = false;
			
			while(in.hasNextLine()) {
				String input = in.nextLine();
				changingFileData.append(input);
				changingFileData.append(lineSeparator);
				StringBuffer result = new StringBuffer();
				
				
				
				if(append) {
					changingFileData.insert(0, leftover);
					changingFileData.deleteCharAt(changingFileData.length()-1);
				}
				
				int numLetters = 0;
				
				for(int i = 0; i < changingFileData.length(); i++) {
					if(Character.isLetter(changingFileData.charAt(i))) {
						numLetters++;
						leftover = changingFileData.charAt(i);
					}
						
				}
				
				append = numLetters % 2 != 0;
				
				//for(int x = 0; x <changingFileData.length(); x++) {
					if(isIFirst) {
						changingFileData = new StringBuffer(changingFileData.toString().replaceAll("j", "i"));
						changingFileData = new StringBuffer(changingFileData.toString().replaceAll("J", "I"));
					} else {
						changingFileData = new StringBuffer(changingFileData.toString().replaceAll("i", "j"));
						changingFileData = new StringBuffer(changingFileData.toString().replaceAll("I", "J"));
					}
					
					
					
					
					char[] digraph = new char[2];
					String cache1 = "";
					String cache2 = "";
					
					
					for(int i = 0; i < 2; i++) {
						char c = changingFileData.charAt(i);
						if(Character.isLetter(c)) {
							digraph[i] = c;
						} else {
							if(i == 0) {
								cache1 += c;
								i--;
							} else {
								cache2 += c;
								i--;
							}
						}
					}
					int[] letter1 = indecies[Character.toUpperCase(digraph[0])-65];
					int[] letter2 = indecies[Character.toUpperCase(digraph[1])-65];
					
					String encryptedPair = "";
					
					char two = key[letter1[0]][letter2[1]];
					char one = key[letter2[0]][letter1[1]];
					
					
					encryptedPair = cache1 + one + cache2 + two;
					
					result.append(encryptedPair);
				//}
				
				
				bwriter.write(result.toString() + lineSeparator);
				
			}
			
			bwriter.flush();
			
			
		} catch (FileNotFoundException e) {
			e.printStackTrace();
		} catch (IOException ex) {
			ex.printStackTrace();
		} finally {
			if(in != null)
				in.close();
			if(bwriter != null) { 
				try {
					bwriter.close();
				} catch (IOException ex) {
					System.out.println("Make like a hockey team"
							+ " and get the puck outta here");
					ex.printStackTrace();
				}
			}
		}
		
		
		
		
		
		
		
		
		
	}

	public void decrypt(String inputFileName, String outputFileName, String keyword) {
		encrypt(inputFileName, outputFileName, keyword);
	}
}
